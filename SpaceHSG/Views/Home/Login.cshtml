@{
    ViewData["Title"] = "Login";
}

<link rel="stylesheet" href="~/css/login.css" />

<div class="login-page" id="loginPage">
    <div class="login-card">
        <div class="theme-toggle">
            <span id="toggleText">Light Mode</span>
            <label class="switch">
                <input type="checkbox" id="themeSwitch">
                <span class="slider round"></span>
            </label>
        </div>

        <div class="login-header">
            <h1>SpaceHSG</h1>
            <p>Secure File Management System</p>
        </div>

        @if (ViewBag.Error != null)
        {
            <div class="login-error">
                @ViewBag.Error
            </div>
        }

        <form method="post">
            <div class="form-group">
                <label>Username</label>
                <input type="text" name="username" placeholder="Enter username" required />
            </div>

            <div class="form-group">
                <label>Password</label>
                <input type="password" name="password" placeholder="Enter password" required />
            </div>

            <button type="submit" class="login-btn">
                Sign In
            </button>
        </form>

        <div class="login-footer">
            © 2026 SpaceHSG Internal System
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const themeSwitch = document.getElementById('themeSwitch');
        const toggleText = document.getElementById('toggleText');
        const loginForm = document.querySelector('form');

        if (!themeSwitch) return;

        // 立即应用主题，防止闪烁
        (function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';

            // 立即设置主题
            document.documentElement.setAttribute('data-bs-theme', savedTheme);

            // 更新UI
            themeSwitch.checked = savedTheme === 'dark';
            if (toggleText) {
                toggleText.innerText = savedTheme === 'dark' ? 'Dark Mode' : 'Light Mode';
            }

            // 确保背景应用
            document.body.style.backgroundColor = '';
        })();

        // 切换主题
        themeSwitch.addEventListener('change', (e) => {
            e.stopPropagation();

            const nextTheme = themeSwitch.checked ? 'dark' : 'light';

            // 更新页面主题
            document.documentElement.setAttribute('data-bs-theme', nextTheme);

            // 保存到 localStorage
            localStorage.setItem('theme', nextTheme);

            // 更新文本
            if (toggleText) {
                toggleText.innerText = nextTheme === 'dark' ? 'Dark Mode' : 'Light Mode';
            }
        });

        // 在表单提交前确保主题保存到localStorage
        if (loginForm) {
            loginForm.addEventListener('submit', function() {
                const currentTheme = themeSwitch.checked ? 'dark' : 'light';
                localStorage.setItem('theme', currentTheme);
            });
        }
    });
</script>