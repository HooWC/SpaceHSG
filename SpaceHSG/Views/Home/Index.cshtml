@{
    ViewData["Title"] = "Company File Manager";
}

<div class="container mt-4">
    <h2 class="mb-4">📁 Company File Manager</h2>

    <!-- Path Display -->
    <div class="alert alert-info">
        <strong>Current Path:</strong> @ViewBag.BasePath
    </div>

    <!-- Error Message -->
    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger">Error: @ViewBag.Error</div>
    }

    <!-- File List Table -->
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Files and Folders List</h5>
        </div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 5%"></th>
                        <th style="width: 40%">Name</th>
                        <th style="width: 15%">Type</th>
                        <th style="width: 15%">Size</th>
                        <th style="width: 15%">Modified Date</th>
                        <th style="width: 10%">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (ViewBag.Items != null)
                    {
                        // Sort: folders first, then files
                        var items = ((IEnumerable<dynamic>)ViewBag.Items)
                        .OrderByDescending(x => x.Type)
                        .ThenBy(x => x.Name);

                        @if (!items.Any())
                        {
                            <tr>
                                <td colspan="6" class="text-center text-muted py-4">
                                    Folder is empty
                                </td>
                            </tr>
                        }

                        @foreach (var item in items)
                        {
                            <tr>
                                <td class="text-center">
                                    @if (item.Type == "Folder")
                                    {
                                        <span style="font-size: 1.2em;">📁</span>
                                    }
                                    else
                                    {
                                        <span style="font-size: 1.2em;">📄</span>
                                    }
                                </td>
                                <td>
                                    <strong>@item.Name</strong>
                                    @if (!string.IsNullOrEmpty(item.Extension) && item.Type == "File")
                                    {
                                        <br />
                                        <small class="text-muted">Extension: @item.Extension</small>
                                    }
                                </td>
                                <td>
                                    @if (item.Type == "Folder")
                                    {
                                        <span class="badge bg-info">Folder</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary">File</span>
                                    }
                                </td>
                                <td>
                                    @if (item.Type == "Folder")
                                    {
                                        <span class="text-muted">-</span>
                                    }
                                    else
                                    {
                                        @if (item.Size < 1024)
                                        {
                                            <span>@item.Size B</span>
                                        }
                                        else if (item.Size < 1024 * 1024)
                                        {
                                            <span>@((item.Size / 1024.0).ToString("0.00")) KB</span>
                                        }
                                        else if (item.Size < 1024 * 1024 * 1024)
                                        {
                                            <span>@((item.Size / (1024.0 * 1024)).ToString("0.00")) MB</span>
                                        }
                                        else
                                        {
                                            <span>@((item.Size / (1024.0 * 1024 * 1024)).ToString("0.00")) GB</span>
                                        }
                                    }
                                </td>
                                <td>
                                    @item.Modified.ToString("yyyy-MM-dd HH:mm")
                                </td>
                                <td>
                                    @if (item.Type == "File")
                                    {
                                        <a href="@Url.Action("Download", new { filename = item.Name })"
                                           class="btn btn-sm btn-outline-primary"
                                           title="Download file">
                                            Download
                                        </a>
                                    }
                                    else
                                    {
                                        <button class="btn btn-sm btn-outline-secondary" disabled
                                                title="Folder operations not supported yet">
                                            Open
                                        </button>
                                    }
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="6" class="text-center text-muted py-4">
                                No files or folders found
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="card-footer text-muted">
            <small>Total @(((IEnumerable<dynamic>)ViewBag.Items)?.Count() ?? 0) items</small>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="mt-3">
        <a href="@Url.Action("Index")" class="btn btn-success">
            🔄 Refresh List
        </a>
        <button class="btn btn-outline-secondary" onclick="location.reload()">
            Reload
        </button>
    </div>
</div>

<!-- Custom Styles -->
<style>
    .table-hover tbody tr:hover {
        background-color: rgba(0, 123, 255, 0.05);
    }

    .card {
        box-shadow: 0 2px 4px rgba(0,0,0,.1);
    }

    th {
        border-bottom: 2px solid #dee2e6 !important;
    }
</style>