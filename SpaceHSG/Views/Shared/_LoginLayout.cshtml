<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - SpaceHSG</title>
    <link rel="stylesheet" href="@Url.Content("~/css/login.css")" asp-append-version="true" />
    <link rel="stylesheet" href="@Url.Content("~/css/onedrive-style.css")" asp-append-version="true" />
</head>
<body>
    <div class="fm-toast-container" id="toastContainer">
        @if (ViewBag.Error != null)
        {
            <div class="fm-toast show fm-toast-error">
                <div class="fm-toast-content">
                    <div class="fm-toast-icon">⚠️</div>
                    <div class="fm-toast-text">
                        <div class="fm-toast-title">Login Error</div>
                        <div class="fm-toast-message">@ViewBag.Error</div>
                    </div>
                    <button class="fm-toast-close" onclick="closeToast(this)">×</button>
                </div>
                <div class="fm-toast-progress"></div>
            </div>
        }
    </div>

    @RenderBody()

    <script src="@Url.Content("~/js/toast.js")" asp-append-version="true"></script>
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-bs-theme', savedTheme);
        })();

        document.addEventListener('DOMContentLoaded', function() {
            function tryShowErrorToast() {
                const errorToast = document.querySelector('.fm-toast-error');
                if (errorToast && typeof showToast === 'function') {
                    const title = errorToast.querySelector('.fm-toast-title')?.textContent || 'Error';
                    const message = errorToast.querySelector('.fm-toast-message')?.textContent || '';
                    if (message) {
                        showToast(title, message, 'error');
                        setTimeout(() => {
                            if (errorToast.parentNode) {
                                errorToast.remove();
                            }
                        }, 100);
                    }
                } else if (errorToast) {
                    setTimeout(tryShowErrorToast, 50);
                }
            }
            tryShowErrorToast();
        });
    </script>
</body>
</html>